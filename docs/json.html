<!DOCTYPE html>  <html> <head>   <title>json.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Cakefile.html">                 Cakefile.coffee               </a>                                           <a class="source" href="ajax.html">                 ajax.coffee               </a>                                           <a class="source" href="json.html">                 json.coffee               </a>                                           <a class="source" href="pystr.html">                 pystr.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               json.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Adds <strong>JSON</strong> to browsers that don't support it natively.
<code>_JSON</code> and <code>_toJSON</code> are also added so this library can be explicitly used.
More information about JSON can be found at <a href="https://developer.mozilla.org/En/Using_JSON_in_Firefox">Using JSON in Firefox</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Based on Douglas Crockford's
<a href="https://github.com/douglascrockford/JSON-js/blob/master/json_parse.js">json_parse.js</a> and 
<a href="https://github.com/douglascrockford/JSON-js/blob/master/json2.js">json2.js</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>A helper function to format integers to have at least two digits.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">_f = </span><span class="nf">(n) -&gt;</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="k">then</span> <span class="s2">&quot;0#{n}&quot;</span> <span class="k">else</span> <span class="nx">n</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h1>toJSON methods</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Add <code>_toJSON</code> methods to standard types, and alias <code>toJSON</code> if native functions don't exist.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Add <code>_toJSON</code> to date objects.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">Date</span><span class="o">::</span><span class="nv">_toJSON = </span><span class="nf">(key) -&gt;</span>
    <span class="k">if</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">@valueOf</span><span class="p">())</span> <span class="k">then</span> <span class="p">(</span>
        <span class="nx">@getUTCFullYear</span><span class="p">()</span>         <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>    <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCDate</span><span class="p">())</span>         <span class="o">+</span> <span class="s1">&#39;T&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCHours</span><span class="p">())</span>        <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCMinutes</span><span class="p">())</span>      <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCSeconds</span><span class="p">())</span>      <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span>
        <span class="nx">_f</span><span class="p">(</span><span class="nx">@getUTCMilliseconds</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;Z&#39;</span>
    <span class="p">)</span> <span class="k">else</span> <span class="kc">null</span>
<span class="k">if</span> <span class="o">not</span> <span class="nb">Date</span><span class="o">::</span><span class="nx">toJSON</span>
    <span class="nb">Date</span><span class="o">::</span><span class="nv">toJSON = </span><span class="nb">Date</span><span class="o">::</span><span class="nx">_toJSON</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Add <code>_toJSON</code> to strings, numbers and booleans.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">String</span><span class="o">::</span><span class="nv">_toJSON = </span><span class="nb">Number</span><span class="o">::</span><span class="nv">_toJSON = </span><span class="nb">Boolean</span><span class="o">::</span><span class="nv">_toJSON = </span><span class="nf">(key) -&gt;</span> <span class="nx">@valueOf</span><span class="p">()</span>
<span class="nb">String</span><span class="o">::</span><span class="nv">toJSON = </span><span class="nb">String</span><span class="o">::</span><span class="nx">_toJSON</span> <span class="k">if</span> <span class="o">not</span> <span class="nb">String</span><span class="o">::</span><span class="nx">toJSON</span>
<span class="nb">Number</span><span class="o">::</span><span class="nv">toJSON = </span><span class="nb">Number</span><span class="o">::</span><span class="nx">_toJSON</span> <span class="k">if</span> <span class="o">not</span> <span class="nb">Number</span><span class="o">::</span><span class="nx">toJSON</span>
<span class="nb">Boolean</span><span class="o">::</span><span class="nv">toJSON = </span><span class="nb">Boolean</span><span class="o">::</span><span class="nx">_toJSON</span> <span class="k">if</span> <span class="o">not</span> <span class="nb">Boolean</span><span class="o">::</span><span class="nx">toJSON</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h1>The JSON class</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">_JSON</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h2>JSON.parse</h2>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>To convert a JSON string into a JavaScript object, you simply pass the JSON into the <code>JSON.parse()</code> method, like this:</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p><code>var jsObject = JSON.parse(jsonString);</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">parse: </span><span class="nf">(text) -&gt;</span>
        <span class="k">return</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">text</span>
        <span class="nv">at = </span><span class="kc">null</span><span class="p">;</span> <span class="nv">ch = </span><span class="s1">&#39; &#39;</span>
        <span class="nv">escapee = </span><span class="s1">&#39;&quot;&#39;</span><span class="o">:</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="o">:</span> <span class="s1">&#39;\\&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">b: </span><span class="s1">&#39;\b&#39;</span><span class="p">,</span> <span class="nv">f: </span><span class="s1">&#39;\f&#39;</span><span class="p">,</span> <span class="nv">n: </span><span class="s1">&#39;\n&#39;</span><span class="p">,</span> <span class="nv">r: </span><span class="s1">&#39;\r&#39;</span><span class="p">,</span> <span class="nv">t: </span><span class="s1">&#39;\t&#39;</span>
        <span class="nv">error = </span><span class="nf">(message) -&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">SyntaxError</span><span class="p">(</span><span class="s2">&quot;#{message} at character ##{at}(#{ch}); for text: #{text}&quot;</span><span class="p">)</span>
        <span class="nv">next = </span><span class="nf">(c) -&gt;</span>
            <span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Expected &#39;#{c}&#39; instead of &#39;#{ch}&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">c</span> <span class="o">and</span> <span class="nx">c</span> <span class="o">isnt</span> <span class="nx">ch</span>
            <span class="nv">ch = </span><span class="nx">text</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">at</span><span class="o">++</span><span class="p">)</span><span class="c1">#null is converted to 0, then we start iterating from there</span>
            </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Parse a number.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">number = </span><span class="o">-&gt;</span>
            <span class="nv">string = </span><span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;-&#39;</span>
                <span class="nv">string = </span><span class="s1">&#39;-&#39;</span><span class="p">;</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="nx">ch</span> <span class="o">&gt;=</span> <span class="s1">&#39;0&#39;</span> <span class="o">and</span> <span class="nx">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span>
                <span class="nx">string</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span> <span class="nx">next</span><span class="p">()</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;.&#39;</span>
                <span class="nx">string</span> <span class="o">+=</span> <span class="s1">&#39;.&#39;</span>
                <span class="nx">string</span> <span class="o">+=</span> <span class="nx">ch</span> <span class="k">while</span> <span class="nx">next</span><span class="p">()</span> <span class="o">and</span> <span class="nx">ch</span> <span class="o">&gt;=</span> <span class="s1">&#39;0&#39;</span> <span class="o">and</span> <span class="nx">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;e&#39;</span> <span class="o">or</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;E&#39;</span>
                <span class="nx">string</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span> <span class="nx">next</span><span class="p">()</span>
                <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;-&#39;</span> <span class="o">or</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;+&#39;</span>
                    <span class="nx">string</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span> <span class="nx">next</span><span class="p">()</span>
                <span class="k">while</span> <span class="nx">ch</span> <span class="o">&gt;=</span> <span class="s1">&#39;0&#39;</span> <span class="o">and</span> <span class="nx">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span>
                    <span class="nx">string</span> <span class="o">+=</span> <span class="nx">ch</span><span class="p">;</span> <span class="nx">next</span><span class="p">()</span>
            <span class="nv">_number = </span><span class="o">+</span><span class="nx">string</span>
            <span class="k">if</span> <span class="o">not</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">_number</span><span class="p">)</span>
                <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Bad number&#39;</span><span class="p">)</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nx">_number</span>
            <span class="k">return</span>
            </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Parse a string.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">string = </span><span class="o">-&gt;</span>
            <span class="nv">_string = </span><span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;&quot;&#39;</span>
                <span class="k">while</span> <span class="nx">next</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;&quot;&#39;</span>
                        <span class="nx">next</span><span class="p">();</span> <span class="k">return</span> <span class="nx">_string</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;\\&#39;</span>
                        <span class="nx">next</span><span class="p">()</span>
                        <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;u&#39;</span>
                            <span class="nv">uffff = </span><span class="mi">0</span>
                            <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="mi">4</span><span class="p">]</span>
                                <span class="nv">hex = </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">next</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
                                <span class="k">break</span> <span class="k">if</span> <span class="o">not</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">hex</span><span class="p">)</span>
                                <span class="nx">uffff</span> <span class="o">*=</span> <span class="mi">16</span> <span class="o">+</span> <span class="nx">hex</span>
                            <span class="nx">_string</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">uffff</span><span class="p">)</span>
                        <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">escapee</span><span class="p">[</span><span class="nx">ch</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
                            <span class="nx">_string</span> <span class="o">+=</span> <span class="nx">escapee</span><span class="p">[</span><span class="nx">ch</span><span class="p">]</span>
                        <span class="k">else</span>  
                            <span class="k">break</span>
                    <span class="k">else</span>
                        <span class="nx">_string</span> <span class="o">+=</span> <span class="nx">ch</span>
            <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Bad string&#39;</span><span class="p">);</span> <span class="k">return</span>
            </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Skip whitespace.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">white = </span><span class="o">-&gt;</span> <span class="nx">next</span><span class="p">()</span> <span class="k">while</span> <span class="nx">ch</span> <span class="o">and</span> <span class="nx">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39; &#39;</span><span class="p">;</span> <span class="k">return</span>
        </pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Parse true, false, or null.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">word = </span><span class="o">-&gt;</span>
            <span class="k">switch</span> <span class="nx">ch</span>
                <span class="k">when</span> <span class="s1">&#39;t&#39;</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">);</span> <span class="kc">true</span>
                <span class="k">when</span> <span class="s1">&#39;f&#39;</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">);</span> <span class="kc">false</span>
                <span class="k">when</span> <span class="s1">&#39;n&#39;</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">);</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">);</span> <span class="kc">null</span>
            <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Unexpected #{ch}&#39;</span><span class="p">);</span> <span class="k">return</span>
            </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Parse an array.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">array = </span><span class="o">-&gt;</span>
            <span class="nv">_array = </span><span class="p">[]</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;[&#39;</span>
                <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">);</span> <span class="nx">white</span><span class="p">()</span>
                <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;]&#39;</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">);</span> <span class="k">return</span> <span class="nx">_array</span>
                <span class="k">while</span> <span class="nx">ch</span>
                    <span class="nx">_array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">());</span> <span class="nx">white</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;]&#39;</span>
                        <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">);</span> <span class="k">return</span> <span class="nx">_array</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span> <span class="nx">white</span><span class="p">()</span>
            <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Bad array&#39;</span><span class="p">);</span> <span class="k">return</span>
            </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Parse an object.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">object = </span><span class="o">-&gt;</span>
            <span class="nv">_object = </span><span class="p">{}</span>
            <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;{&#39;</span>
                <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">);</span> <span class="nx">white</span><span class="p">()</span>
                <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;}&#39;</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">);</span> <span class="k">return</span> <span class="nx">_object</span>
                <span class="k">while</span> <span class="nx">ch</span>
                    <span class="nv">key = </span><span class="nx">string</span><span class="p">();</span> <span class="nx">white</span><span class="p">();</span> <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_object</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
                        <span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Duplicate key &#39;#{key}&quot;</span><span class="p">)</span>
                    <span class="nx">_object</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">();</span> <span class="nx">white</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nx">ch</span> <span class="o">is</span> <span class="s1">&#39;}&#39;</span>
                        <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">);</span> <span class="k">return</span> <span class="nx">_object</span>
                    <span class="nx">next</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span> <span class="nx">white</span><span class="p">()</span>
            <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Bad object&#39;</span><span class="p">);</span> <span class="k">return</span>
            </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Parse a JSON value. It could be an object, an array, a string, a number, or a word.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">value = </span><span class="o">-&gt;</span>
            <span class="nx">white</span><span class="p">()</span>
            <span class="k">switch</span> <span class="nx">ch</span>
                <span class="k">when</span> <span class="s1">&#39;{&#39;</span>
                    <span class="k">return</span> <span class="nx">object</span><span class="p">()</span>
                <span class="k">when</span> <span class="s1">&#39;[&#39;</span>
                    <span class="k">return</span> <span class="nx">array</span><span class="p">()</span>
                <span class="k">when</span> <span class="s1">&#39;&quot;&#39;</span>
                    <span class="k">return</span> <span class="nx">string</span><span class="p">()</span>
                <span class="k">when</span> <span class="s1">&#39;-&#39;</span>
                    <span class="k">return</span> <span class="nx">number</span>
                <span class="k">else</span>        
                    <span class="k">return</span> <span class="k">if</span> <span class="nx">ch</span> <span class="o">&gt;=</span> <span class="s1">&#39;0&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">ch</span> <span class="o">&lt;=</span> <span class="s1">&#39;9&#39;</span> <span class="k">then</span> <span class="nx">number</span><span class="p">()</span> <span class="k">else</span> <span class="nx">word</span><span class="p">()</span>
        </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Kick off the parser and return the results.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">result = </span><span class="nx">value</span><span class="p">();</span> <span class="nx">white</span><span class="p">()</span>
        <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Syntax error&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">ch</span>
        <span class="nx">result</span>
    </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>JSON.stringify</h2>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>To convert a JavaScript object into a JSON string, pass the object into the <code>JSON.stringify()</code> method:</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>var jsonString = JSON.stringify({'user': 'John Doe', 'time': new Date(), 'hobies': ['fishing', 'skiing', 'sailing']});</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>JSON.stringify()</code> offers additional customization capabilities through the use of optional parameters. The syntax is:</p>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <ul>
<li><strong>value</strong>: The JavaScript object to convert into a JSON string.</li>
<li><strong>replacer</strong>: A function that alters the behavior of the stringification process, or an array of String and Number objects that serve as a whitelist for selecting the properties of the value object to be included in the JSON string. If this value is null or not provided, all properties of the object are included in the resulting JSON string.</li>
<li><strong>space</strong>: A String or Number object that's used to insert white space into the output JSON string for readability purposes. If this is a Number, it indicates the number of space characters to use as white space; this number is capped at 10 if it's larger than that. Values less than 1 indicate that no space should be used. If this is a String, the string (or the first 10 characters of the string, if it's longer than that) is used as white space. If this parameter is not provided (or is null), no white space is used.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">stringify: </span><span class="nf">(value, replacer=null, space=0) -&gt;</span>
        <span class="nv">gap = </span><span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="nv">indent = </span><span class="s1">&#39;&#39;</span>
        <span class="nv">escapable = </span><span class="sr">/[\\\&quot;\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g</span>
        <span class="nv">meta = </span><span class="s1">&#39;\b&#39;</span><span class="o">:</span> <span class="s1">&#39;\\b&#39;</span><span class="p">,</span> <span class="s1">&#39;\t&#39;</span><span class="o">:</span> <span class="s1">&#39;\\t&#39;</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="o">:</span> <span class="s1">&#39;\\n&#39;</span><span class="p">,</span> <span class="s1">&#39;\f&#39;</span><span class="o">:</span> <span class="s1">&#39;\\f&#39;</span><span class="p">,</span> <span class="s1">&#39;\r&#39;</span><span class="o">:</span> <span class="s1">&#39;\\r&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">:</span> <span class="s1">&#39;\\&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;\\&#39;</span><span class="o">:</span> <span class="s1">&#39;\\\\&#39;</span>
        <span class="nv">max = </span><span class="nf">(a, b) -&gt;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">a</span> <span class="k">else</span> <span class="nx">b</span>
        <span class="nv">min = </span><span class="nf">(a, b) -&gt;</span> <span class="k">if</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="k">then</span> <span class="nx">a</span> <span class="k">else</span> <span class="nx">b</span>
        <span class="k">if</span> <span class="k">typeof</span> <span class="nx">space</span> <span class="o">is</span> <span class="s1">&#39;number&#39;</span>
            <span class="nx">indent</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">min</span><span class="p">(</span><span class="nx">max</span><span class="p">(</span><span class="nx">space</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">10</span><span class="p">)]</span>
        <span class="k">else</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">space</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
            <span class="nx">indent</span> <span class="o">+=</span> <span class="nx">space</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span> <span class="k">for</span> <span class="nx">s</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">...</span><span class="nx">min</span><span class="p">(</span><span class="nx">space</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;JSON.stringify&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nx">replacer</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">replacer</span> <span class="o">isnt</span> <span class="s1">&#39;function&#39;</span> <span class="o">and</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">replacer</span> <span class="o">isnt</span> <span class="s1">&#39;object&#39;</span> <span class="o">or</span> <span class="k">typeof</span> <span class="nx">replacer</span><span class="p">.</span><span class="nx">length</span> <span class="o">isnt</span> <span class="s1">&#39;number&#39;</span><span class="p">)</span>
        
        <span class="nv">quote = </span><span class="nf">(string) -&gt;</span>
            <span class="nv">escapable.lastIndex = </span><span class="mi">0</span>
            <span class="k">return</span> <span class="k">if</span> <span class="nx">escapable</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="k">then</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">escapable</span><span class="p">,</span> <span class="nf">(a) -&gt;</span>
                <span class="nv">c = </span><span class="nx">meta</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">c</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span> <span class="k">then</span> <span class="nx">c</span> <span class="k">else</span> <span class="s1">&#39;\\u&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;0000&#39;</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;\&quot;#{string}\&quot;&quot;</span>
            
        <span class="nv">str = </span><span class="nf">(key, holder) -&gt;</span>
            <span class="nv">mind = </span><span class="nx">gap</span>
            <span class="nv">_value = </span><span class="nx">holder</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Use <code>_toJSON</code> so we fully use this library.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">_value = </span><span class="nx">_value</span><span class="p">.</span><span class="nx">_toJSON</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="k">if</span> <span class="nx">_value</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">_value</span> <span class="o">is</span> <span class="s1">&#39;object&#39;</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">_value</span><span class="p">.</span><span class="nx">_toJSON</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>If a replacer function was passed in run the key and value through it.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">_value = </span><span class="nx">replacer</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">holder</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">_value</span><span class="p">)</span> <span class="k">if</span> <span class="k">typeof</span> <span class="nx">replacer</span> <span class="o">is</span> <span class="s1">&#39;function&#39;</span>
            
            <span class="k">switch</span> <span class="k">typeof</span> <span class="nx">_value</span>
                <span class="k">when</span> <span class="s1">&#39;string&#39;</span>
                    <span class="nx">quote</span><span class="p">(</span><span class="nx">_value</span><span class="p">)</span>
                <span class="k">when</span> <span class="s1">&#39;number&#39;</span>
                    <span class="k">if</span> <span class="nb">isFinite</span><span class="p">(</span><span class="nx">_value</span><span class="p">)</span> <span class="k">then</span> <span class="nb">String</span><span class="p">(</span><span class="nx">_value</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;null&#39;</span>
                <span class="k">when</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span>
                    <span class="nb">String</span><span class="p">(</span><span class="nx">_value</span><span class="p">)</span>
                <span class="k">when</span> <span class="s1">&#39;object&#39;</span>
                    <span class="k">return</span> <span class="s1">&#39;null&#39;</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">_value</span>
                    <span class="nx">gap</span> <span class="o">+=</span> <span class="nx">indent</span><span class="p">;</span> <span class="nv">partial = </span><span class="p">[]</span>
                    <span class="k">if</span> <span class="nb">Object</span><span class="o">::</span><span class="nx">toString</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">_value</span><span class="p">)</span> <span class="o">is</span> <span class="s1">&#39;[object Array]&#39;</span>
                        <span class="k">for</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">_value</span>
                            <span class="nx">partial</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">str</span><span class="p">(</span><span class="o">+</span><span class="nx">i</span><span class="p">,</span> <span class="nx">_value</span><span class="p">)</span> <span class="o">or</span> <span class="s1">&#39;null&#39;</span><span class="p">)</span>
                        <span class="nv">v = </span><span class="k">if</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s1">&#39;[]&#39;</span> <span class="k">else</span>
                            <span class="k">if</span> <span class="nx">gap</span> <span class="k">then</span> <span class="s1">&#39;[\n&#39;</span> <span class="o">+</span> <span class="nx">gap</span> <span class="o">+</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,\n&#39;</span> <span class="o">+</span> <span class="nx">gap</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">mind</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span> 
                            <span class="k">else</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>                
                        <span class="nv">gap = </span><span class="nx">mind</span><span class="p">;</span> <span class="nx">v</span>
                    <span class="k">else</span>
                        <span class="k">if</span> <span class="nx">replacer</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">replacer</span> <span class="o">is</span> <span class="s1">&#39;object&#39;</span>
                            <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">replacer</span>
                                <span class="k">if</span> <span class="k">typeof</span> <span class="nx">replacer</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">is</span> <span class="s1">&#39;string&#39;</span>
                                    <span class="nv">v = </span><span class="nx">str</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">_value</span><span class="p">)</span>
                                    <span class="nx">partial</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">quote</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="nx">gap</span> <span class="k">then</span> <span class="s1">&#39;: &#39;</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="nx">v</span>
                        <span class="k">else</span>
                            <span class="k">for</span> <span class="nx">k</span> <span class="k">of</span> <span class="nx">_value</span>
                                <span class="k">if</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">_value</span><span class="p">,</span> <span class="nx">k</span><span class="p">)</span>
                                    <span class="nv">v = </span><span class="nx">str</span><span class="p">(</span><span class="nx">k</span><span class="p">,</span> <span class="nx">_value</span><span class="p">)</span>
                                    <span class="nx">partial</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">quote</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="nx">gap</span> <span class="k">then</span> <span class="s1">&#39;: &#39;</span> <span class="k">else</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">v</span><span class="p">)</span> <span class="k">if</span> <span class="nx">v</span>
                        <span class="nv">v = </span><span class="k">if</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s1">&#39;{}&#39;</span> <span class="k">else</span> 
                            <span class="k">if</span> <span class="nx">gap</span> <span class="k">then</span> <span class="s1">&#39;{\n&#39;</span> <span class="o">+</span> <span class="nx">gap</span> <span class="o">+</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,\n&#39;</span> <span class="o">+</span> <span class="nx">gap</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">mind</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                            <span class="k">else</span> <span class="s1">&#39;{&#39;</span> <span class="o">+</span> <span class="nx">partial</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span>
                        <span class="nv">gap = </span><span class="nx">mind</span><span class="p">;</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Kick off the stringification and return the result.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">str</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;&#39;</span><span class="o">:</span> <span class="nx">value</span><span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h1>Exposing the class</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Make <code>_JSON</code> avalible incase we want to use this object instead of the native one.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="vi">@_JSON = </span><span class="k">new</span> <span class="nx">_JSON</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Alias <code>JSON</code> if it's not nativly supported.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="vi">@JSON = </span><span class="nx">@_JSON</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">@JSON</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 